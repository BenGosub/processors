# Tasks

build:
  - docker build -t opentrialsrobot/warehouse .

deploy:
  - ${CI?"Deployment is avaiable only on CI/CD server"}
  - docker login
    -e $OPENTRIALS_DOCKER_EMAIL
    -u $OPENTRIALS_DOCKER_USER
    -p $OPENTRIALS_DOCKER_PASS
  - tutum login
    -u $OPENTRIALS_DOCKER_USER
    -p $OPENTRIALS_DOCKER_PASS
  - docker push opentrialsrobot/warehouse
  - tutum stack inspect exporter ||
    tutum stack create --sync -f docker-compose/exporter.yml -n exporter
  - tutum stack update --sync -f docker-compose/exporter.yml exporter
  - tutum stack inspect mapper ||
    tutum stack create --sync -f docker-compose/mapper.yml -n mapper
  - tutum stack update --sync -f docker-compose/mapper.yml mapper
  - tutum stack inspect processor ||
    tutum stack create --sync -f docker-compose/processor.yml -n processor
  - tutum stack update --sync -f docker-compose/processor.yml processor

test:
  # - pylama exporter
  # - pylama mapper
  # - pylama processor
  - py.test tests
